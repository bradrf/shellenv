#!/usr/bin/python

import boto
import argparse

parser = argparse.ArgumentParser(description='Generate signed URL for S3 access to objects',
                                 formatter_class=argparse.ArgumentDefaultsHelpFormatter)
parser.add_argument('-m', '--method', choices=['get','put','post','head'], default='get',
                    help='http method')
parser.add_argument('-s', '--seconds', default=60, type=int,
                    help='time in seconds until the URL will expire')
parser.add_argument('-t', '--type', default='application/octet-stream',
                    help='specify an alternate content type for put/post methods')
parser.add_argument('path',
                    help='path to sign')
args = parser.parse_args()

if args.method in ['put','post']:
    headers = {'Content-Type': args.type}
else:
    headers = None

parts = args.path.split('/', 1)
bucket = parts[0]
key = parts[1] if len(parts) > 1 else ''

s3 = boto.connect_s3()
print s3.generate_url(args.seconds, args.method.upper(), bucket=bucket, key=key, headers=headers)
